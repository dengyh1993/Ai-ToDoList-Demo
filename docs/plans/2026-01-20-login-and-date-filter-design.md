# ç™»å½•åŠŸèƒ½ + æ—¥æœŸç­›é€‰åŠŸèƒ½ è®¾è®¡æ–‡æ¡£

> åˆ›å»ºæ—¥æœŸï¼š2026-01-20

## æ¦‚è¿°

ä¸º AI å¾…åŠäº‹é¡¹åº”ç”¨æ–°å¢ä¸¤ä¸ªåŠŸèƒ½ï¼š
1. **ç”¨æˆ·ç™»å½•ç³»ç»Ÿ**ï¼šä½¿ç”¨ Supabase Authï¼Œæ”¯æŒé‚®ç®±/å¯†ç  + GitHub OAuth
2. **æ—¥æœŸç­›é€‰åŠŸèƒ½**ï¼šå¿«æ·æŒ‰é’®ï¼ˆä»Šå¤©/æœ¬å‘¨/æœ¬æœˆ/å…¨éƒ¨ï¼‰+ è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´

---

## ä¸€ã€ç™»å½•åŠŸèƒ½è®¾è®¡

### 1.1 æŠ€æœ¯é€‰å‹

- **è®¤è¯æœåŠ¡**ï¼šSupabase Authï¼ˆå·²æœ‰ Supabase åŸºç¡€è®¾æ–½ï¼‰
- **ç™»å½•æ–¹å¼**ï¼š
  - é‚®ç®±/å¯†ç æ³¨å†Œç™»å½•
  - GitHub OAuth ä¸€é”®ç™»å½•

### 1.2 æ•°æ®åº“æ”¹åŠ¨

```sql
-- ç”¨æˆ·è¡¨ç”± Supabase Auth è‡ªåŠ¨ç®¡ç†ï¼ˆauth.usersï¼‰

-- ä¿®æ”¹ todos è¡¨ï¼Œå¢åŠ ç”¨æˆ·å…³è”
ALTER TABLE todos ADD COLUMN user_id UUID REFERENCES auth.users(id);

-- ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤å€¼ï¼ˆå¯é€‰ï¼Œæˆ–æ¸…ç©ºé‡å»ºï¼‰
-- UPDATE todos SET user_id = 'default-user-id' WHERE user_id IS NULL;

-- å¯ç”¨ Row Level Security
ALTER TABLE todos ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥ï¼šç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„ä»»åŠ¡
CREATE POLICY "ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä»»åŠ¡" ON todos
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "ç”¨æˆ·åªèƒ½åˆ›å»ºè‡ªå·±çš„ä»»åŠ¡" ON todos
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„ä»»åŠ¡" ON todos
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„ä»»åŠ¡" ON todos
  FOR DELETE USING (auth.uid() = user_id);
```

### 1.3 é¡µé¢ç»“æ„

```
src/app/
â”œâ”€â”€ (auth)/                   # è®¤è¯ç›¸å…³é¡µé¢ç»„
â”‚   â”œâ”€â”€ login/page.tsx        # ç™»å½•é¡µ
â”‚   â””â”€â”€ signup/page.tsx       # æ³¨å†Œé¡µ
â”œâ”€â”€ page.tsx                  # ä¸»é¡µï¼ˆéœ€è¦ç™»å½•ï¼‰
â””â”€â”€ components/
    â”œâ”€â”€ AuthForm.tsx          # ç™»å½•/æ³¨å†Œè¡¨å•ç»„ä»¶
    â””â”€â”€ UserMenu.tsx          # ç”¨æˆ·å¤´åƒ+é€€å‡ºç™»å½•
```

### 1.4 ç™»å½•é¡µé¢ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI å¾…åŠäº‹é¡¹                  â”‚
â”‚      æ™ºèƒ½æ‹†è§£ä»»åŠ¡ï¼Œè®©å¤æ‚å˜ç®€å•        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ğŸ“§ é‚®ç®±                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ğŸ”’ å¯†ç                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚   [        ç™» å½•        ]           â”‚
â”‚                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                     â”‚
â”‚   [  ğŸ™ ä½¿ç”¨ GitHub ç™»å½•  ]          â”‚
â”‚                                     â”‚
â”‚   è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ ç«‹å³æ³¨å†Œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 è®¤è¯æµç¨‹

1. **é‚®ç®±/å¯†ç ç™»å½•**ï¼šè°ƒç”¨ `supabase.auth.signInWithPassword()`
2. **GitHub OAuth**ï¼šè°ƒç”¨ `supabase.auth.signInWithOAuth({ provider: 'github' })`
3. **æ³¨å†Œæµç¨‹**ï¼šè°ƒç”¨ `supabase.auth.signUp()`ï¼Œå¯é€‰é‚®ç®±éªŒè¯
4. **ç™»å½•æˆåŠŸ**ï¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µ
5. **è·¯ç”±ä¿æŠ¤**ï¼šä¸»é¡µæ£€æµ‹æœªç™»å½•åˆ™é‡å®šå‘åˆ° `/login`
6. **é€€å‡ºç™»å½•**ï¼šè°ƒç”¨ `supabase.auth.signOut()`

### 1.6 ç”¨æˆ·èœå•

ç™»å½•ååœ¨é¡µé¢å³ä¸Šè§’æ˜¾ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ ç”¨æˆ·å    â”‚  â† ç‚¹å‡»å±•å¼€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€€å‡ºç™»å½•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ—¥æœŸç­›é€‰åŠŸèƒ½è®¾è®¡

### 2.1 ç­›é€‰ UI

æ”¾åœ¨ä»»åŠ¡åˆ—è¡¨ä¸Šæ–¹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å…¨éƒ¨] [ä»Šå¤©] [æœ¬å‘¨] [æœ¬æœˆ]    ğŸ“… è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â†“ ç‚¹å‡»å±•å¼€
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å¼€å§‹: 2026-01-15  â”‚
                              â”‚ ç»“æŸ: 2026-01-20  â”‚
                              â”‚    [åº”ç”¨ç­›é€‰]      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç­›é€‰é€»è¾‘

| æŒ‰é’® | æ—¶é—´èŒƒå›´ |
|------|----------|
| å…¨éƒ¨ | ä¸é™åˆ¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡ |
| ä»Šå¤© | `created_at` åœ¨ä»Šå¤© 00:00 ~ 23:59 |
| æœ¬å‘¨ | æœ¬å‘¨ä¸€ 00:00 ~ æœ¬å‘¨æ—¥ 23:59 |
| æœ¬æœˆ | æœ¬æœˆ 1 æ—¥ 00:00 ~ æœ¬æœˆæœ€åä¸€å¤© 23:59 |
| è‡ªå®šä¹‰ | ç”¨æˆ·é€‰æ‹©çš„èµ·æ­¢æ—¥æœŸèŒƒå›´ |

### 2.3 ç»„ä»¶çŠ¶æ€ç±»å‹

```typescript
type DateFilterType = 'all' | 'today' | 'week' | 'month' | 'custom'

interface DateFilter {
  type: DateFilterType
  start?: Date  // ä»… custom æ—¶ä½¿ç”¨
  end?: Date    // ä»… custom æ—¶ä½¿ç”¨
}
```

### 2.4 API æ”¹åŠ¨

```typescript
// GET /api/todos?start=2026-01-15&end=2026-01-20

// åç«¯æŸ¥è¯¢å¢åŠ æ—¶é—´è¿‡æ»¤
const { start, end } = request.query

let query = supabase
  .from('todos')
  .select('*')
  .order('created_at', { ascending: false })

if (start) {
  query = query.gte('created_at', start)
}
if (end) {
  query = query.lte('created_at', end + 'T23:59:59')
}
```

### 2.5 æ—¥æœŸè®¡ç®—å·¥å…·å‡½æ•°

```typescript
// src/lib/dateUtils.ts

export function getDateRange(type: DateFilterType): { start: Date; end: Date } | null {
  const now = new Date()

  switch (type) {
    case 'all':
      return null
    case 'today':
      return {
        start: startOfDay(now),
        end: endOfDay(now)
      }
    case 'week':
      return {
        start: startOfWeek(now, { weekStartsOn: 1 }), // å‘¨ä¸€å¼€å§‹
        end: endOfWeek(now, { weekStartsOn: 1 })
      }
    case 'month':
      return {
        start: startOfMonth(now),
        end: endOfMonth(now)
      }
    default:
      return null
  }
}
```

### 2.6 æ–°å¢ç»„ä»¶

```
src/app/components/
â””â”€â”€ DateFilter.tsx    # æ—¥æœŸç­›é€‰ç»„ä»¶
```

---

## ä¸‰ã€å®ç°æ­¥éª¤

### Phase 1: ç™»å½•åŠŸèƒ½
1. é…ç½® Supabase Auth å’Œ GitHub OAuth Provider
2. ä¿®æ”¹æ•°æ®åº“è¡¨ç»“æ„ï¼Œæ·»åŠ  `user_id` å­—æ®µå’Œ RLS ç­–ç•¥
3. åˆ›å»º `AuthForm` ç»„ä»¶ï¼ˆç™»å½•/æ³¨å†Œè¡¨å•ï¼‰
4. åˆ›å»ºç™»å½•é¡µ `/login` å’Œæ³¨å†Œé¡µ `/signup`
5. åˆ›å»º `UserMenu` ç»„ä»¶ï¼ˆç”¨æˆ·èœå• + é€€å‡ºç™»å½•ï¼‰
6. ä¿®æ”¹ä¸»é¡µï¼Œæ·»åŠ ç™»å½•çŠ¶æ€æ£€æŸ¥å’Œè·¯ç”±ä¿æŠ¤
7. ä¿®æ”¹ API è·¯ç”±ï¼Œæ·»åŠ ç”¨æˆ·è®¤è¯å’Œ `user_id` å…³è”

### Phase 2: æ—¥æœŸç­›é€‰åŠŸèƒ½
1. åˆ›å»ºæ—¥æœŸå·¥å…·å‡½æ•° `dateUtils.ts`
2. åˆ›å»º `DateFilter` ç»„ä»¶
3. ä¿®æ”¹ `/api/todos` æ¥å£ï¼Œæ”¯æŒæ—¥æœŸèŒƒå›´å‚æ•°
4. åœ¨ä¸»é¡µé›†æˆæ—¥æœŸç­›é€‰ç»„ä»¶
5. æµ‹è¯•å„ç­›é€‰æ¡ä»¶

---

## å››ã€ä¾èµ–é¡¹

æ— éœ€æ–°å¢ npm ä¾èµ–ï¼ŒSupabase JS SDK å·²åŒ…å« Auth åŠŸèƒ½ã€‚

å¦‚éœ€æ›´å¥½çš„æ—¥æœŸé€‰æ‹©å™¨ä½“éªŒï¼Œå¯é€‰ï¼š
- `react-datepicker`ï¼ˆæ¨èï¼Œè½»é‡ï¼‰
- `@headlessui/react`ï¼ˆæ— æ ·å¼ UI ç»„ä»¶ï¼‰

---

## äº”ã€ç¯å¢ƒå˜é‡

éœ€è¦åœ¨ Supabase æ§åˆ¶å°é…ç½® GitHub OAuthï¼š
1. è¿›å…¥ Supabase Dashboard â†’ Authentication â†’ Providers
2. å¯ç”¨ GitHub Provider
3. é…ç½® GitHub OAuth App çš„ Client ID å’Œ Secret

---

## å…­ã€é¢„ä¼°å·¥ä½œé‡

| ä»»åŠ¡ | é¢„ä¼°æ—¶é—´ |
|------|----------|
| ç™»å½•åŠŸèƒ½ï¼ˆå«æ•°æ®åº“æ”¹åŠ¨ï¼‰ | 2-3 å°æ—¶ |
| æ—¥æœŸç­›é€‰åŠŸèƒ½ | 1-2 å°æ—¶ |
| **æ€»è®¡** | **3-5 å°æ—¶** |
